openapi: 3.1.0
info:
  title: ZANTARA API - Direct Endpoints
  description: Bali Zero Business Services API
  version: 5.2.0
servers:
  - url: https://nuzantara-backend.fly.dev
    description: Production server (Fly.io)

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key

paths:
  /health:
    get:
      operationId: checkHealth
      summary: Check API health
      security: []
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  version:
                    type: string

  /contact.info:
    get:
      operationId: getContactInfo
      summary: Get Bali Zero contact information
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Contact information retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  company:
                    type: string
                  services:
                    type: array
                    items:
                      type: string
                  communication:
                    type: object
                    properties:
                      email:
                        type: string
                      whatsapp:
                        type: string

  /lead.save:
    post:
      operationId: saveLead
      summary: Save a new lead
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - service
              properties:
                name:
                  type: string
                  description: Lead name
                email:
                  type: string
                  description: Lead email
                service:
                  type: string
                  description: Service type
                details:
                  type: string
                  description: Additional details
                nationality:
                  type: string
                  description: Lead nationality
                urgency:
                  type: string
                  enum: [normal, urgent, immediate]
      responses:
        '200':
          description: Lead saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  leadId:
                    type: string
                  followUpScheduled:
                    type: boolean

  /identity.resolve:
    post:
      operationId: resolveUserIdentity
      summary: Resolve user identity
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
      responses:
        '200':
          description: Identity resolved
          content:
            application/json:
              schema:
                type: object

  /ai.chat:
    post:
      operationId: chatWithAI
      summary: Chat with AI assistant
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - prompt
              properties:
                prompt:
                  type: string
                  description: User message
                model:
                  type: string
                  description: AI model to use
                  default: auto
      responses:
        '200':
          description: AI response
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: string
                  model:
                    type: string

  /metrics:
    get:
      operationId: getSystemMetrics
      summary: Get system metrics
      security: []
      responses:
        '200':
          description: System metrics
          content:
            application/json:
              schema:
                type: object

  /docs:
    get:
      operationId: getAPIDocs
      summary: Get API documentation
      security: []
      responses:
        '200':
          description: API documentation
          content:
            text/html:
              schema:
                type: string

  /call:
    post:
      operationId: callHandler
      summary: Call a specific handler
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - key
                - params
              properties:
                key:
                  type: string
                  description: Handler key to call
                  enum:
                    - sheets.create
                    - sheets.read
                    - sheets.append
                    - drive.upload
                    - calendar.create
                params:
                  type: object
                  description: Handler parameters
                  properties:
                    title:
                      type: string
                      description: Title of the new spreadsheet (for sheets.create)
                    data:
                      type: array
                      description: Initial data for the spreadsheet (for sheets.create)
                      items:
                        type: array
                        items:
                          type: string
                    spreadsheetId:
                      type: string
                      description: ID of the spreadsheet (for sheets.read and sheets.append)
                    range:
                      type: string
                      description: Range in A1 notation, e.g. "Sheet1!A1:B10" (for sheets.read and sheets.append)
                    values:
                      type: array
                      description: Data to append to the sheet (for sheets.append)
                      items:
                        type: array
                        items:
                          type: string
                    fileName:
                      type: string
                      description: Name of the file (for drive.upload)
                    mimeType:
                      type: string
                      description: MIME type of file (for drive.upload)
                    media:
                      type: object
                      description: File content (for drive.upload)
                      properties:
                        body:
                          type: string
                          description: Base64 encoded file content
                    calendarId:
                      type: string
                      description: Calendar ID (for calendar.create) - use "primary" for default or specific ID for other calendars
                      default: primary
                    event:
                      type: object
                      description: Calendar event details (for calendar.create)
                      properties:
                        summary:
                          type: string
                          description: Event title
                        description:
                          type: string
                          description: Event description
                        start:
                          type: object
                          properties:
                            dateTime:
                              type: string
                              description: ISO 8601 datetime
                            timeZone:
                              type: string
                        end:
                          type: object
                          properties:
                            dateTime:
                              type: string
                              description: ISO 8601 datetime
                            timeZone:
                              type: string
                        attendees:
                          type: array
                          items:
                            type: object
                            properties:
                              email:
                                type: string
      responses:
        '200':
          description: Handler executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      spreadsheetId:
                        type: string
                        description: ID of created spreadsheet (sheets.create)
                      url:
                        type: string
                        description: URL to edit the spreadsheet (sheets.create)
                      values:
                        type: array
                        description: Data read from spreadsheet (sheets.read)
                        items:
                          type: array
                      update:
                        type: object
                        description: Update information (sheets.append)
                        properties:
                          updatedRange:
                            type: string
                          updatedRows:
                            type: number
                          updatedCells:
                            type: number
                      file:
                        type: object
                        description: Uploaded file information (drive.upload)
                        properties:
                          id:
                            type: string
                          name:
                            type: string
                          webViewLink:
                            type: string
                      event:
                        type: object
                        description: Created calendar event (calendar.create)
                        properties:
                          id:
                            type: string
                          htmlLink:
                            type: string
                          status:
                            type: string