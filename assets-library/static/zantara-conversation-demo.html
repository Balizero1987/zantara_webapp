<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZANTARA Intelligence v6 - Live Demo Conversation</title>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Geist', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a0033 0%, #2D1B69 50%, #6B46C1 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .demo-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
        }

        .demo-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .demo-header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(45deg, #ffffff, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .demo-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }

        .conversation-log {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .message {
            margin-bottom: 24px;
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid;
            position: relative;
        }

        .message.user {
            background: rgba(99, 102, 241, 0.2);
            border-left-color: #6366f1;
        }

        .message.zantara {
            background: rgba(167, 139, 250, 0.2);
            border-left-color: #a78bfa;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
        }

        .message.user .message-sender {
            color: #6366f1;
        }

        .message.zantara .message-sender {
            color: #a78bfa;
        }

        .handler-badge {
            background: rgba(16, 185, 129, 0.3);
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: #10b981;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .message-content {
            font-size: 14px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        .thinking {
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .demo-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 8px;
        }

        .demo-btn:hover {
            background: linear-gradient(135deg, #5855eb, #7c3aed);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .demo-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            margin: 16px 0;
        }

        .typing-dots {
            display: inline-flex;
            margin-left: 8px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #a78bfa;
            animation: pulse 1.4s ease-in-out infinite;
            margin: 0 2px;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        .stats {
            margin-top: 20px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }

        .highlight {
            color: #a78bfa;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üß† ZANTARA Intelligence v6</h1>
            <p>Live Demo - Intelligent Conversation with 125+ Handlers</p>
        </div>

        <div class="conversation-log" id="conversationLog">
            <div class="message zantara">
                <div class="message-header">
                    <span class="message-sender">ZANTARA</span>
                    <span class="handler-badge">system.welcome</span>
                </div>
                <div class="message-content">
                    üëã Welcome! I'm ZANTARA Intelligence v6 - your complete AI assistant for Bali Zero.
                    I have access to <span class="highlight">125+ specialized capabilities</span> and can intelligently route your requests to the right handler.
                    <br><br>
                    Try the demo buttons below to see how I automatically detect what you need and respond accordingly!
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            ZANTARA is thinking<div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="controls">
            <button class="demo-btn" onclick="askAboutTeam()">üë• Show Team Members</button>
            <button class="demo-btn" onclick="askAboutPricing()">üí∞ Get Pricing Info</button>
            <button class="demo-btn" onclick="askAboutContact()">üìû Company Contact</button>
            <button class="demo-btn" onclick="askAboutCapabilities()">üß† My Capabilities</button>
            <button class="demo-btn" onclick="askAboutVisa()">üõÇ Visa Information</button>
            <button class="demo-btn" onclick="askAboutCompany()">üè¢ Company Setup</button>
        </div>

        <div class="stats">
            <p>üöÄ Status: <span class="highlight">Online</span> ‚Ä¢ Handlers Available: <span class="highlight">125+</span> ‚Ä¢ Response Time: <span class="highlight">~200ms</span></p>
        </div>
    </div>

    <script>
        // Dynamic API config: query > localStorage > default (localhost in dev)
        const qs = new URLSearchParams(window.location.search);
        const DEFAULT_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
          ? 'http://localhost:8080'
          : 'https://api.balizero.com';
        const API_BASE = qs.get('api') || localStorage.getItem('API_BASE') || DEFAULT_BASE;
        const API_KEY = qs.get('key') || localStorage.getItem('API_KEY') || 'zantara-internal-dev-key-2025';

        let conversationCount = 0;

        function addMessage(sender, content, handler = null) {
            const log = document.getElementById('conversationLog');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';

            const senderSpan = document.createElement('span');
            senderSpan.className = 'message-sender';
            senderSpan.textContent = sender === 'user' ? 'You' : 'ZANTARA';

            headerDiv.appendChild(senderSpan);

            if (handler) {
                const badgeSpan = document.createElement('span');
                badgeSpan.className = 'handler-badge';
                badgeSpan.textContent = handler;
                headerDiv.appendChild(badgeSpan);
            }

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = content;

            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            log.appendChild(messageDiv);

            log.scrollTop = log.scrollHeight;
        }

        function showTyping(show) {
            const typing = document.getElementById('typingIndicator');
            typing.style.display = show ? 'block' : 'none';
        }

        function disableButtons(disabled) {
            const buttons = document.querySelectorAll('.demo-btn');
            buttons.forEach(btn => btn.disabled = disabled);
        }

        async function makeRequest(key, params, userMessage) {
            try {
                showTyping(true);
                disableButtons(true);

                addMessage('user', userMessage);

                const response = await fetch(`${API_BASE}/call`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY
                    },
                    body: JSON.stringify({ key, params })
                });

                const result = await response.json();

                setTimeout(() => {
                    showTyping(false);

                    if (result.ok) {
                        let content = formatResponse(result.data, key);
                        addMessage('zantara', content, key);
                    } else {
                        addMessage('zantara', `‚ùå Error: ${result.error}`, 'error');
                    }

                    disableButtons(false);
                    conversationCount++;
                }, 1000 + Math.random() * 1000); // Simulate thinking time

            } catch (error) {
                showTyping(false);
                addMessage('zantara', `‚ùå Network Error: ${error.message}`, 'error');
                disableButtons(false);
            }
        }

        function formatResponse(data, handler) {
            if (handler === 'team.list' && data.members) {
                let content = `üë• <strong>Bali Zero Team</strong> (${data.members.length} members)<br><br>`;

                const depts = {};
                data.members.forEach(member => {
                    const dept = member.department || 'Other';
                    if (!depts[dept]) depts[dept] = [];
                    depts[dept].push(member);
                });

                Object.entries(depts).forEach(([dept, members]) => {
                    const deptInfo = data.departments[dept];
                    if (deptInfo) {
                        content += `<strong>${deptInfo.icon} ${deptInfo.name}:</strong><br>`;
                    } else {
                        content += `<strong>${dept.toUpperCase()}:</strong><br>`;
                    }

                    members.forEach(member => {
                        content += `‚Ä¢ ${member.badge} ${member.name} - ${member.role}<br>`;
                    });
                    content += '<br>';
                });

                return content;
            }

            if (handler === 'contact.info' && data) {
                const email = data?.communication?.email || data?.email || '';
                const whatsapp = data?.communication?.whatsapp || data?.whatsapp || '';
                const instagram = data?.communication?.instagram || data?.instagram || '';
                const office = (typeof data?.office === 'object') ? (data.office.location || '') : (data?.office || '');

                return `üè¢ <strong>${data.company}</strong><br>` +
                       `üìç ${data.tagline}<br><br>` +
                       `<strong>üìß Contact Information:</strong><br>` +
                       `‚Ä¢ Email: ${email}<br>` +
                       `‚Ä¢ WhatsApp: ${whatsapp}<br>` +
                       `‚Ä¢ Instagram: ${instagram}<br>` +
                       `‚Ä¢ Office: ${office}<br><br>` +
                       `<strong>‚è∞ Availability:</strong> ${data.availability}`;
            }

            if (handler === 'pricing.official' && data.categories) {
                let content = `üí∞ <strong>Bali Zero Official Pricing 2025</strong><br><br>`;

                Object.entries(data.categories).forEach(([category, services]) => {
                    content += `<strong>${category.toUpperCase()}:</strong><br>`;
                    Object.entries(services).forEach(([service, info]) => {
                        content += `‚Ä¢ ${service}: ‚Ç¨${info.price} (${info.timeline})<br>`;
                    });
                    content += '<br>';
                });

                return content;
            }

            if (handler.includes('ai.') && data.response) {
                return `ü§ñ ${data.response}`;
            }

            if (typeof data === 'string') return data;
            if (data.message) return data.message;

            return `‚úÖ Response received!<br><pre style="font-size: 11px; opacity: 0.7; margin-top: 8px;">${JSON.stringify(data, null, 2)}</pre>`;
        }

        async function askAboutTeam() {
            await makeRequest('team.list', {}, 'Show me all the team members working at Bali Zero');
        }

        async function askAboutPricing() {
            await makeRequest('pricing.official', {}, 'What are your pricing packages and rates?');
        }

        async function askAboutContact() {
            await makeRequest('contact.info', {}, 'Give me the contact information for Bali Zero');
        }

        async function askAboutCapabilities() {
            await makeRequest('ai.chat', { prompt: 'Tell me about your 125+ capabilities and how you can help businesses in Bali. Be specific about your intelligent routing system.' }, 'Tell me about your capabilities and intelligent features');
        }

        async function askAboutVisa() {
            await makeRequest('ai.chat', { prompt: 'I need help with visa applications for Bali. What types of visas do you handle and what is the process?' }, 'I need help with visa applications for Bali');
        }

        async function askAboutCompany() {
            await makeRequest('quote.generate', { service: 'company', details: 'I want to set up a company in Bali for my business' }, 'I want to set up a company in Bali for my business');
        }

        // Auto-start demo
        setTimeout(() => {
            addMessage('zantara', `üéØ <strong>Intelligence Demo Ready!</strong><br><br>I can automatically detect what you need:<br>‚Ä¢ Team questions ‚Üí <span class="highlight">team.list</span> handler<br>‚Ä¢ Pricing queries ‚Üí <span class="highlight">pricing.official</span> handler<br>‚Ä¢ Contact requests ‚Üí <span class="highlight">contact.info</span> handler<br>‚Ä¢ General questions ‚Üí <span class="highlight">ai.chat</span> with smart routing<br><br>Click any button above to see intelligent conversation in action! üöÄ`, 'routing.demo');
        }, 2000);
    </script>
</body>
</html>
