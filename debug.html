<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Debug Syncra Flow</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
    pre { background: #000; padding: 10px; border: 1px solid #0f0; overflow-x: auto; }
    button { background: #0f0; color: #000; border: none; padding: 8px 16px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>DEBUG: Syncra Login Flow</h1>
  <pre id="output"></pre>

  <button onclick="setEmail()">Set Email (Login)</button>
  <button onclick="clearEmail()">Clear Email (Logout)</button>
  <button onclick="testSyncra()">Test Syncra</button>
  <button onclick="checkElements()">Check DOM Elements</button>

  <script>
    const log = (msg) => {
      const output = document.getElementById('output');
      output.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
    };

    function checkStorage() {
      log('=== LocalStorage Check ===');
      log(`Email: ${localStorage.getItem('zantara-user-email') || '(not set)'}`);
      log(`Session: ${localStorage.getItem('zantara-session-id') || '(not set)'}`);
      log(`User flag: ${localStorage.getItem('zantara_user') || '(not set)'}`);
    }

    function setEmail() {
      localStorage.setItem('zantara-user-email', 'test@example.com');
      log('✓ Email set to test@example.com');
      checkStorage();
    }

    function clearEmail() {
      localStorage.removeItem('zantara-user-email');
      localStorage.removeItem('zantara-session-id');
      localStorage.removeItem('zantara_user');
      log('✓ Cleared all auth data');
      checkStorage();
    }

    function testSyncra() {
      log('Opening syncra.html in new window...');
      const win = window.open('/syncra.html', '_blank');

      setTimeout(() => {
        log('Checking if redirected...');
        try {
          log(`Window location: ${win.location.href}`);
        } catch(e) {
          log('Cannot read window location (cross-origin or redirected)');
        }
      }, 1000);
    }

    function checkElements() {
      log('=== Checking Syncra Elements ===');

      // Create hidden iframe to load syncra
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = '/syncra.html';
      document.body.appendChild(iframe);

      iframe.onload = () => {
        try {
          const doc = iframe.contentDocument;

          // Check key elements
          const welcome = doc.getElementById('welcome-screen');
          const chat = doc.getElementById('chat-interface');
          const splash = doc.getElementById('splash-screen');

          log(`Welcome screen: ${welcome ? `found, display=${welcome.style.display}` : 'NOT FOUND'}`);
          log(`Chat interface: ${chat ? `found, display=${chat.style.display}` : 'NOT FOUND'}`);
          log(`Splash screen: ${splash ? `found, display=${splash.style.display}` : 'NOT FOUND'}`);

          // Check if app initialized
          const hasApp = iframe.contentWindow.zantaraApp ? 'YES' : 'NO';
          log(`ZantaraApp initialized: ${hasApp}`);

        } catch(e) {
          log(`Error checking elements: ${e.message}`);
        }

        document.body.removeChild(iframe);
      };
    }

    // Initial check
    checkStorage();
    log('Debug page ready');
  </script>
</body>
</html>